# AI管理平台整体架构设计

## 1. 架构概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        AI Management Platform                           │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌──────────┐  │
│  │  Gateway    │    │  Registry   │    │  Config     │    │  Monitor │  │
│  │  (API网关)  │◄──►│  (Nacos)    │◄──►│  (Nacos)    │◄──►│  (SkyWalking)│
│  └─────────────┘    └─────────────┘    └─────────────┘    └──────────┘  │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    AI Core Services Layer                         │  │
│  ├─────────────────┬─────────────────┬─────────────────────────────┤  │
│  │  AI-Orchestrator│  AI-Processor   │  AI-Agent-Manager           │  │
│  │  (编排服务)     │  (处理服务)     │  (智能体管理服务)           │  │
│  └─────────────────┴─────────────────┴─────────────────────────────┘  │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    AI Capability Layer                            │  │
│  ├─────────────────┬─────────────────┬─────────────────────────────┤  │
│  │  Homework-AI    │  Chat-AI        │  Grading-AI                 │  │
│  │  (作业AI)       │  (聊天AI)       │  (批改AI)                   │  │
│  └─────────────────┴─────────────────┴─────────────────────────────┘  │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Infrastructure Layer                           │  │
│  ├─────────────────┬─────────────────┬─────────────────────────────┤  │
│  │  Model Gateway  │  Vector Store   │  Message Queue              │  │
│  │  (模型网关)     │  (向量存储)     │  (消息队列)                 │  │
│  └─────────────────┴─────────────────┴─────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2. 服务分层说明

### 2.1 接入层（Gateway Layer）
- **统一API网关**：负责路由、认证、限流、熔断
- **服务注册发现**：Nacos作为服务注册中心
- **配置中心**：Nacos统一配置管理
- **监控告警**：SkyWalking全链路监控

### 2.2 核心服务层（Core Services Layer）
- **AI-Orchestrator**: 负责AI能力的编排和调度，根据业务场景选择合适的AI服务
- **AI-Processor**: 处理通用的AI任务，如文本预处理、后处理、格式转换等
- **AI-Agent-Manager**: 智能体生命周期管理，包括创建、更新、销毁、状态监控

### 2.3 AI能力层（AI Capability Layer）
- **Homework-AI**: 专门处理作业相关AI能力
  - 文本转写提取结构化信息
  - 作业内容理解与分类
  - 作业难度评估
- **Chat-AI**: AI老师陪伴聊天答疑
  - 多轮对话管理
  - 知识库问答
  - 情感识别与响应
- **Grading-AI**: 作业批改AI
  - 主观题批改
  - 客观题批改
  - 批改结果分析

### 2.4 基础设施层（Infrastructure Layer）
- **Model Gateway**: 统一模型访问网关，支持多模型提供商（通义千问、OpenAI等）
- **Vector Store**: 向量数据库，用于知识库检索和语义相似度计算
- **Message Queue**: RocketMQ消息队列，用于异步处理和削峰填谷

## 3. 技术栈选型

| 层级 | 技术组件 | 版本 | 说明 |
|------|----------|------|------|
| **核心框架** | Spring Boot | 3.4.2 | 微服务基础框架 |
| | Spring Cloud | 2024.0.0 | 微服务治理 |
| | Spring AI | 1.0.0 | AI能力抽象 |
| **AI基础设施** | 通义千问 | Qwen-Max/Plus | 主要大模型 |
| | Milvus | 2.3+ | 向量数据库 |
| | RocketMQ | 5.0+ | 消息队列 |
| **数据存储** | Redis | 7.0+ | 缓存和会话存储 |
| | MongoDB | 6.0+ | 文档存储 |
| | MySQL | 8.0+ | 关系型数据 |
| **监控运维** | Nacos | 2.2+ | 服务注册发现 |
| | SkyWalking | 9.5+ | 链路追踪 |
| | Prometheus | 2.40+ | 指标监控 |
| | Grafana | 10.0+ | 可视化 |

## 4. 部署架构

### 4.1 开发环境
- **部署方式**：Docker Compose
- **服务数量**：单实例部署
- **依赖服务**：本地启动Redis、MongoDB、RocketMQ

### 4.2 生产环境
- **部署方式**：Kubernetes集群
- **服务数量**：多实例部署，按需扩缩容
- **网络策略**：服务网格(Istio)管理流量
- **安全策略**：TLS加密、RBAC权限控制

### 4.3 混合云部署
- **核心服务**：私有云部署（数据敏感操作）
- **AI推理**：公有云GPU资源（计算密集型）
- **数据同步**：跨云数据同步机制